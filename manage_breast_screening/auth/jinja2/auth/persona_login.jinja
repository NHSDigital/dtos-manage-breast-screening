{% extends 'layout-app.jinja' %}
{% from "nhsuk/components/button/macro.jinja" import button %}

{% block page_content %}
<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-full">
    <h1 class="nhsuk-heading-l">
      {{ page_title }}
    </h1>

    {% for user in users %}
      <h2>{{ user.first_name }} {{ user.last_name }}{% if user == current_user %} (logged in){% endif %}</h2>
      <p>{{ user.first_name }} has <b>{{ user.groups.all() | map(attribute='name') | join(', ') }}</b> access.</p>

      {% if user != current_user %}
      <form action="{{ request.path }}" method="post" novalidate>
        {{ csrf_input }}
        <input type="hidden" name="username" value="{{ user.nhs_uid }}">
        <input type="hidden" name="next" value="{{ next }}">

        {{ button({
          "text": "Login as " ~ user.first_name ~ ' ' ~ user.last_name
        }) }}
      </form>
      {% endif %}

      {% if not loop.last %}<hr class="nhsuk-section-break--m">{% endif %}
    {% endfor %}
  </div>
</div>

{% endblock page_content %}
