{% extends "wizard_step.jinja" %}
{% from "nhsuk/components/button/macro.jinja" import button %}
{% from "nhsuk/components/card/macro.jinja" import card %}
{% from "nhsuk/components/inset-text/macro.jinja" import insetText %}
{% from "nhsuk/components/summary-list/macro.jinja" import summaryList %}
{% from "components/participant-details/summary_list_rows.jinja" import last_mammogram_html %}

{% block step_content %}

{% call card({"heading": "Mammogram history"}) %}
  <p>The last confirmed mammogram and any added manually since then</p>

  {{ summaryList({
    "rows": [
      {
        "key": {
          "text": "Last known mammograms"
        },
        "value": {
          "html": last_mammogram_html(presented_mammograms)
        }
      },
    ]
  }) }}

  {{ button({
    "text": presenter.add_mammogram_button.text,
    "href": presenter.add_mammogram_button.href,
    "classes": "nhsuk-button--secondary nhsuk-button--small"
  }) }}

{% endcall %}

{% call card({
  "heading": "Symptoms",
}) %}
  <p {%- if not presenter.symptom_rows %} class="nhsuk-u-margin-bottom-3"{% endif %}>Any problems or symptoms, including lumps, swelling, rashes or nipple changes</p>
  {% if presenter.symptom_rows %}
     {{ summaryList({
        "rows": presenter.symptom_rows
      }) }}
  {% else %}
    {% set insetHtml %}
      <p>No symptoms have been recorded for this participant.</p>
    {% endset %}
    {{ insetText({
      "html": insetHtml,
      "classes": "nhsuk-u-margin-top-0 nhsuk-u-margin-bottom-4"
    }) }}
  {% endif %}

  <hr>
  <h3>Add symptoms</h3>

  <div class="nhsuk-button-group app-button-group--small">
    {% for button_info in presenter.symptom_buttons %}
      {{ button({
        "text": button_info.text,
        "href": button_info.href,
        "classes": "nhsuk-button--secondary nhsuk-button--small"
      }) }}
    {% endfor %}
  </div>
{% endcall %}

{% set medical_history_card_html %}
  {% set breast_cancer_history_html %}
    {% for presented_item in presenter.breast_cancer_history %}
      <a style="float: right" class="nhsuk-link nhsuk-link--no-visited-state" href="{{ presented_item.change_link.href}}">
        {{ presented_item.change_link.text }}<span class="nhsuk-u-visually-hidden">{{ presented_item.change_link.visually_hidden_text }}</span>
      </a><br>
      {{ summaryList(presented_item.summary_list_params) }}
    {% endfor %}
  {% endset %}

  {% set mastectomy_or_lumpectomy_history_html %}
    {% for presented_item in presenter.mastectomy_or_lumpectomy_history %}
      <a style="float: right" class="nhsuk-link nhsuk-link--no-visited-state" href="{{ presented_item.change_link.href}}">
        {{ presented_item.change_link.text }}<span class="nhsuk-u-visually-hidden">{{ presented_item.change_link.visually_hidden_text }}</span>
      </a><br>
      {{ summaryList(presented_item.summary_list_params) }}
    {% endfor %}
  {% endset %}

  {% set implanted_medical_device_history_html %}
    {% for presented_item in presenter.implanted_medical_device_history %}
      <a style="float: right" class="nhsuk-link nhsuk-link--no-visited-state" href="{{ presented_item.change_link.href}}">
        {{ presented_item.change_link.text }}<span class="nhsuk-u-visually-hidden">{{ presented_item.change_link.visually_hidden_text }}</span>
      </a><br>
      {{ summaryList(presented_item.summary_list_params) }}
    {% endfor %}
  {% endset %}

  {% set breast_augmentation_history_html %}
    {% for presented_item in presenter.breast_augmentation_history %}
      <a style="float: right" class="nhsuk-link nhsuk-link--no-visited-state" href="{{ presented_item.change_link.href}}">
        {{ presented_item.change_link.text }}<span class="nhsuk-u-visually-hidden">{{ presented_item.change_link.visually_hidden_text }}</span>
      </a><br>
      {{ summaryList(presented_item.summary_list_params) }}
    {% endfor %}
  {% endset %}

  {% set other_procedure_history_html %}
    {% for presented_item in presenter.other_procedure_history %}
      <a style="float: right" class="nhsuk-link nhsuk-link--no-visited-state" href="{{ presented_item.change_link.href}}">
        {{ presented_item.change_link.text }}<span class="nhsuk-u-visually-hidden">{{ presented_item.change_link.visually_hidden_text }}</span>
      </a><br>
      {{ summaryList(presented_item.summary_list_params) }}
    {% endfor %}
  {% endset %}

  {% set cyst_history_html %}
    {% for presented_item in presenter.cyst_history %}
      <a style="float: right" class="nhsuk-link nhsuk-link--no-visited-state" href="{{ presented_item.change_link.href}}">
        {{ presented_item.change_link.text }}<span class="nhsuk-u-visually-hidden">{{ presented_item.change_link.visually_hidden_text }}</span>
      </a><br>
      {{ summaryList(presented_item.summary_list_params) }}
    {% endfor %}
  {% endset %}

  {% set benign_lump_history_html %}
    {% for presented_item in presenter.benign_lump_history %}
      {{ summaryList(presented_item.summary_list_params) }}
      <p><a href="{{ presented_item.change_link.href }}" class="nhsuk-link nhsuk-link--no-visited-state">{{ presented_item.change_link.text }}</a></p>
    {% endfor %}
  {% endset %}

  {{ summaryList({
    "rows": [
     {
       "key": {
         "text": "Breast cancer history"
       },
       "value": {
         "html": breast_cancer_history_html
       },
       "actions": {
          "items": []
       }
     },
     {
       "key": {
         "text": "Implanted medical device history"
       },
       "value": {
         "html": implanted_medical_device_history_html
       }
     },
     {
       "key": {
         "text": "Cyst history"
       },
       "value": {
         "html": cyst_history_html
       },
       "actions": {
          "items": []
       }
     },
     {
      "key": {
         "text": "Breast implants or augmentation"
       },
       "value": {
         "html": breast_augmentation_history_html
       },
       "actions": {
          "items": []
       }
     },
     {
       "key": {
         "text": "Other procedure history"
       },
       "value": {
         "html": other_procedure_history_html
       },
       "actions": {
          "items": []
       }
     },
     {
       "key": {
         "text": "Benign lump history"
       },
       "value": {
         "html": benign_lump_history_html
       },
       "actions": {
          "items": []
       }
     },
     {
       "key": {
         "text": "Mastectomy or lumpectomy history"
       },
       "value": {
         "html": mastectomy_or_lumpectomy_history_html
       },
       "actions": {
          "items": []
       }
     }
    ]
  }) }}

  <hr>
  <h3>Add medical history</h3>

  <div class="nhsuk-button-group app-button-group--small">
    {% for button_info in presenter.medical_history_buttons %}
      {{ button({
        "text": button_info.text,
        "href": button_info.href,
        "classes": "nhsuk-button--secondary nhsuk-button--small"
      }) }}
    {% endfor %}
  </div>

{% endset %}
{{ card({
  "heading": "Medical history",
  "descriptionHtml": medical_history_card_html
}) }}

{% set breast_features_card_html %}
    {% set breast_features_recorded = false %}

    {% set insetHtml %}
    <p>No breast features have been recorded for this participant. Add any scars, moles, warts or lumps observed or reported during the appointment.</p>
    {% endset %}
    {{ insetText({
      "html": insetHtml,
      "classes": "nhsuk-u-margin-top-0 nhsuk-u-margin-bottom-4 app-inset-text"
    }) }}

    <p class="nhsuk-u-margin-top-4 nhsuk-u-margin-bottom-0">
      <a href="#" class="nhsuk-link nhsuk-link--no-visited-state">{{ "Add another feature" if breast_features_recorded else "Add a feature" }}</a>
    </p>
{% endset %}
{{ card({
  "heading": "Breast features",
  "descriptionHtml": breast_features_card_html
}) }}

{% set other_information_card_html %}
  {% set hrt_link %}
  <a class="nhsuk-link" href="#">Enter hormone replacement therapy (HRT)</a>
  {% endset %}
  {% set pregnancy_and_breastfeeding_link %}
  <a class="nhsuk-link" href="#">Enter pregnancy and breastfeeding</a>
  {% endset %}
{% endset %}
{{ card({
  "heading": "Other information",
  "descriptionHtml": other_information_card_html
}) }}

{% endblock %}
