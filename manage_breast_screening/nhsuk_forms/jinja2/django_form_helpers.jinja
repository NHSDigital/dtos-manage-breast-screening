{% from 'nhsuk/components/error-summary/macro.jinja' import errorSummary %}

{% macro form_error_summary(form, title="There is a problem") %}
    {% if form.errors %}
      {% set ns = namespace(errors=[]) %}

      {% for field in form %}
        {% if field.errors %}
          {% set ns.errors = ns.errors + [{"text": field.errors[0], "href": "#" ~ field.auto_id}] %}
        {% endif %}
      {% endfor %}
      {% for error in form.non_field_errors() %}
        {% set ns.errors = ns.errors + [{"text": error}] %}
      {% endfor %}

      {{ errorSummary({
        "titleText": title,
        "errorList": ns.errors
      }) }}
    {% endif %}
{% endmacro %}
