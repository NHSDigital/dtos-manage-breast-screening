{% from "summary-list/macro.jinja" import summaryList %}
{% from "components/participant-details/summary_list_rows.jinja" import date_of_birth_and_age_html, ethnicity_html, last_mammogram_html %}

{% macro participant_details(presented_participant, presented_mammograms, return_url=none, full_details=true, screening_protocol=none) %}
  {% if return_url is none %}
    {{ raise('return_url is required') }}
  {% endif %}

  {% set ethnicity_details_url = presented_participant.ethnicity_url(return_url) %}
  {% set ethnicity_change_link = {
      "items": [
        {
          "href": ethnicity_details_url,
          "text": "Change",
          "classes": "nhsuk-link--no-visited-state",
          "visuallyHiddenText": "ethnicity"
        }
      ]
    } if presented_participant.ethnic_background else undefined %}

  {{ summaryList({
    "rows": [
     {
       "key": {
         "text": "NHS Number"
       },
       "value": {
         "text": presented_participant.nhs_number
       }
     } if full_details else undefined,
     {
       "key": {
         "text": "Full name"
       },
       "value": {
         "text": presented_participant.full_name
       }
     },
     {
       "key": {
         "text": "Gender"
       },
       "value": {
         "text": presented_participant.gender
       }
     } if full_details else undefined,
     {
       "key": {
         "text": "Date of birth"
       },
       "value": {
         "html": date_of_birth_and_age_html(presented_participant)
       }
     },
     {
       "key": {
         "text": "Ethnicity"
       },
       "value": {
         "html": ethnicity_html(presented_participant) | safe
       },
       "actions": ethnicity_change_link
     },
    ]
  }) }}
{% endmacro %}
