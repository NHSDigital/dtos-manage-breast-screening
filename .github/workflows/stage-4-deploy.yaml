name: "Build stage"

on:
  workflow_call:
    inputs:
      commit_sha:
        description: Commit SHA of both pipeline and docker image tag
        required: true
        type: string

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    environment: review

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - uses: azure/login@v2
      with:
        client-id: 85735519-c39b-470f-857b-172ed9196e0f
        tenant-id: 50f6071f-bbfe-401a-8803-673748e629e2
        subscription-id: 67aab2fa-fcc7-49da-9dc6-cb90f0fa0628

    - name: Call deployment pipeline
      run: |
        az pipelines run --commit-id ${{inputs.commit_sha}} --name Deployment2 --org https://dev.azure.com/nhse-dtos --project dtos-manage-breast-screening --parameters commit_sha=${{inputs.commit_sha}}
